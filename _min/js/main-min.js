function getClientWidth(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth}function getClientHeight(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}function isset(e){return!(void 0===e||null===e)}function setLocalStorage(e,t){if(localStorage)try{return localStorage.setItem(e,JSON.stringify(t)),!0}catch(e){return console.log(e),!1}}function getLocalStorage(e,t){if(!localStorage)return t;var o=localStorage.getItem(e);return this.isset(o)?JSON.parse(o):t}function removeLocalStorage(e){if(localStorage)return localStorage.removeItem(e)}function clearLocalStorage(){if(localStorage)return localStorage.clear()}function deepClone(e){if(!isset(e))return e;if(e instanceof Date){var t=new Date;return t.setTime(e.getTime()),t}if(e instanceof Array){var t=[];for(var o in e)t[o]=deepClone(e[o]);return t}if(e instanceof Function)return e;if(e instanceof Object){var t={};for(var o in e)e.hasOwnProperty(o)&&(t[o]=deepClone(e[o]));return t}return e}function setCanvasSize(e,t,o,r){if(e.width=t||e.width,e.height=o||e.height,r)return r()}function sortNumber(e,t){return t-e}var ruleData={classic:{block:4,scroll:!1,two:!1,pro:!1,tip:"playTime",progressBar:"block",require:"block",addRequire:"none",score:"playTime",max:25,sub:[{max:25},{max:50},{max:50,pro:!0},{max:50,block:5},{max:50,block:6}]},arcade:{block:4,scroll:!0,two:!1,pro:!1,tip:"block",progressBar:"none",require:"none",addRequire:"none",score:"block",speed:3.1,speedup:.02,speedMax:5,sub:[{speed:3.1,speedup:.02,speedMax:7},{speed:4.5,speedup:.03,speedMax:14},{speed:3.1,speedup:.02,speedMax:7,two:!0,pro:!0},{speed:3.1,speedup:.02,speedMax:7,block:5},{speed:3.1,speedup:.02,speedMax:7,block:6}]},zen:{block:4,scroll:!1,two:!1,pro:!1,tip:"block",progressBar:"timeLeft",require:"time",addRequire:"none",score:"block",timeMax:15,sub:[{timeMax:15},{timeMax:30},{timeMax:30,pro:!0},{timeMax:30,block:5},{timeMax:30,block:6}]},rush:{block:4,scroll:!0,two:!1,pro:!1,tip:"speed",progressBar:"none",require:"none",addRequire:"none",score:"speed",speed:3.1,speedup:.055,sub:[{speed:3.1,speedup:.055},{speed:3.1,speedup:.055,two:!0,pro:!0},{speed:3.1,speedup:.055,pro:!0},{speed:3.1,speedup:.055,block:5},{speed:3.1,speedup:.055,block:6}]},relay:{block:4,scroll:!1,two:!1,pro:!1,tip:"timeLeft",progressBar:"loop",require:"loop",addRequire:"none",score:"block",max:50,timeMax:8,sub:[{timeMax:8},{timeMax:10},{timeMax:12,pro:!0},{timeMax:10,block:5},{timeMax:10,block:6}]}},languageData={list:["zh-cn","zh-tw"],misc:{bilibiliName:"IceSpirit",weiboName:"@Zero_IceSpirit",umoniURL:"http://www.umoni.com",bilibiliURL:"https://space.bilibili.com/486633",weiboURL:"https://weibo.com/xkywr",mode:["classic","arcade","zen","rush","relay"],settings:["back","leaderboard","profile","sound","language","about"],symbol:[" ♪",'"',"/s",": "," "]},"zh-cn":{languageName:"简体中文",gameName:"别踩白块儿(钢琴块儿)-仿",ver:"Html5 Canvas ver0.17",mode:"模式",randomMode:"随机",settings:"设置",back:"返回",leaderboard:"排行榜",profile:"个人概况",sound:"音效",language:"语言",about:"关于",start:"开始",share:"炫耀",exit:"返回",again:"重来",best:"历史最佳",newBest:"新纪录",endGame:"结束",playOn:"继续玩",noScore:"音符不够",noScoreTip:"多玩几轮，踩集更多的音符",failed:"败了",reset:"重置",bestScore:"最佳成绩",gamesPlayed:"游戏次数",tilesCollected:"踩集块数",reScore:"重置将会清空当前所有成绩数据，你确定重置吗？",contact:"联系本人",subscribe:"不来关注一下我吗？",thanks:"感谢原开发团队",thanksFor:"Umoni Studio",bilibili:"bilibili",weibo:"微博",modeList:{classic:["经典",["25","50","不连续","5 x 5","6 x 6"]],arcade:["街机",["正常","更快","双块","5 x 5","6 x 6"]],zen:["禅",['15"','30"',"不连续","5 x 5","6 x 6"]],rush:["极速",["正常","双块","不连续","5 x 5","6 x 6"]],relay:["接力",['8"','10"','12"',"5 x 5","6 x 6"]]},soundList:["默认","关闭"],errorTipCoin:"你的音符♪不够了,再去踩点吧",errorTip:["就是饿死,从这跳下去,也不会再继续了！","不要让你家喵主子乱动！","我从未见过如此手残之人！","别放弃挑战哦!","人若无梦想,同咸鱼何异!","你是传奇!","用道具你可以更高分!","为新纪录冲刺吧!","原地复活!高分!高分!","速度快起来!快!快!"]},"zh-tw":{languageName:"繁体中文",gameName:"別踩白塊兒(鋼琴塊兒)-仿",ver:"Html5 Canvas ver0.17",mode:"模式",randomMode:"隨機",settings:"設置",back:"返回",leaderboard:"排行榜",profile:"個人概況",sound:"音效",language:"語言",about:"關於",start:"開始",share:"炫耀",exit:"返回",again:"重來",best:"歷史最佳",newBest:"新紀錄",endGame:"結束",playOn:"繼續玩",noScore:"音符不夠",noScoreTip:"多玩幾輪，踩集更多的音符",failed:"敗了",reset:"重置",bestScore:"最佳成績",gamesPlayed:"遊戲次數",tilesCollected:"踩集塊數",reScore:"重置將會清空當前所有成績數據，你確定重置嗎？",contact:"聯繫本人",subscribe:"不來關注一下我嗎？",thanks:"感謝原開發團隊",thanksFor:"Umoni Studio",bilibili:"bilibili",weibo:"微博",modeList:{classic:["經典",["25","50","不連續","5 x 5","6 x 6"]],arcade:["街機",["正常","更快","雙塊","5 x 5","6 x 6"]],zen:["禪",['15"','30"',"不連續","5 x 5","6 x 6"]],rush:["極速",["正常","雙塊","不連續","5 x 5","6 x 6"]],relay:["接力",['8"','10"','12"',"5 x 5","6 x 6"]]},soundList:["默認","關閉"],errorTipCoin:"你的音符♪不夠了,再去踩點吧",errorTip:["就是餓死,從這跳下去,也不會再繼續了！","不要讓你家貓主子亂動！","我從未見過如此手殘之人！","別放弃挑戰哦！","人若無夢想,同鹹魚何异！","你是傳奇！","用道具你可以更高分！","為新紀錄衝刺吧！","原地復活！高分！高分！","速度快起來！快！快！"]}};HTMLCanvasElement.prototype.setCanvasSize=function(e,t,o){var r=this;if(r.width=e||r.width,r.height=t||r.height,o)return o()},CanvasRenderingContext2D.prototype.roundRect=function(e,t,o,r,i,a){var s=Math.min(o,r),l=this;return i>s/2&&(i=s/2),l.beginPath(),l.moveTo(e+i,t),l.arcTo(e+o,t,e+o,t+r,i),l.lineTo(e+o,t+i),l.arcTo(e+o,t+r,e,t+r,i),l.lineTo(e+o-i,t+r),l.arcTo(e,t+r,e,t,i),l.lineTo(e,t+r-i),l.arcTo(e,t,e+o,t,i),l.closePath(),!a||l[a](),l},function(){for(var e=0,t=["webkit","moz","ms"],o=0;o<t.length&&!window.requestAnimationFrame;++o)window.requestAnimationFrame=window[t[o]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[o]+"CancelAnimationFrame"]||window[t[o]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,o){var r=(new Date).getTime(),i=Math.max(0,16.7-(r-e)),a=window.setTimeout(function(){t(r+i)},i);return e=r+i,a}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}();var game=function(){this.name="DontTapTheWhiteTile",this.cid="canvas",this.c2d=null,this.canvas=null,this.animationId=null,this.audioContext=null,this.domPage="about",this.page="menu",this.pageName=["menu","game","settings","end"],this.language=languageData,this.rule=ruleData,this.img={umoni:new Image,bilibili:new Image,weibo:new Image},this.img.umoni.src="./image/umoni.png",this.img.bilibili.src="./image/bilibili.png",this.img.weibo.src="./image/weibo.png",this.sound={click:"./sound/click.mp3",error:"./sound/error.mp3",timeEnd:"./sound/timeEnd.mp3",victory:"./sound/victory.mp3"},this.score={coin:0,bestScore:null,gamesPlayed:null,tilesCollected:null,leaderboard:null},this.b={width:null,height:null,mode:null,sub:0,subPos:0,clickTime:12,frameTimeMax:34,run:{gameStart:!1,errorState:!1,subScoll:{on:!1,startTime:0,startPos:0,startLeft:0,startTop:0,subWidth:0},rule:{},time:{start:null,run:null,currRun:null,last:null,curr:null,interval:null},list:null,listMax:null,listPos:null,runPos:null,lastPos:null,score:null,timeLeft:null,speed:null,pause:null,error:{listPos:-1,pos:-1,frame:0,coinDemand:0,errorTip:""},errorNum:0,endColor:null,placeholder:null,currScore:{score:"",scoreTip:""}}},this.dom={htmlWidth:null,htmlHeight:null,width:null,height:null,offsetLeft:null,offsetTop:null,scrollLeft:null,scrollLeft:null,domList:document.getElementById("domList"),dTop:document.getElementById("dTop"),dReturn:document.getElementById("dReturn"),dTopTitle:document.getElementById("dTopTitle"),dReset:document.getElementById("dReset"),dContent:document.getElementById("dContent")},this.style={fontName:"Microsoft YaHei",width:1080,height:1920,scale:{width:1,height:1},color:{normal:"#FFFFFF",reverse:"#000000"},tip:{},menu:{color:{settings:"#AAAAAA"},font:{title:{size:90,bold:!0},coin:{size:43,bold:!0}},e:{button:{width:540,height:640,fontLeft:270,fontTop:320},coin:{left:1070,top:10}}},game:{color:{line:"rgba(34,34,34,0.6)",bg:"#F5F5F5",block:"rgb(120, 220, 250)",onblock:"rgba(255,255,255,0.75)",error:"#F55",gameTip:"#F33",gameTipS:"rgba(34,34,34,0.5)",subBg:"#F9E718",onsubBg:"#000",sub:"#000",onsub:"#FFF",victory:"#5D7",ProgressBar:[{r:255,g:30,b:30},{r:255,g:255,b:0},{r:80,g:255,b:80}],ProgressBarS:"rgba(100,100,100,0.4)",gray:"#CACACA",shadow:"rgba(0,0,0,0.55)"},font:{gameTip:{size:90,bold:!0},sub:{size:60,bold:!0},start:{size:90,bold:!0},errorTip:{size:54,bold:!0},errorTitle:{size:200,bold:!0},errorTitleSub:{size:70,blod:!0},button:{size:60},onbutton:{size:70},coin:{size:48}},e:{sub:{width:336,height:384,fontLeft:168,fontTop:192,marginRight:2},gameTip:{left:540,top:77},blockTip:{left:135,top:240},errorShadow:{left:54,top:474,width:972,height:972,radius:97},errorBg:{left:68,top:487,width:946,height:946,radius:94},errorTipBg:{left:108,top:530,width:864,height:120,radius:43},buttonOut:{left:118,top:1178,width:388,height:194,radius:38,lineWidth:2,fontLeft:312,fontTop:1272},buttonGo:{left:583,top:1178,width:388,height:194,radius:38,fontLeft:777,fontTop:1240,fontTopB:1313},errorTip:{left:540,top:590},errorTitle:{left:540,top:821},errorSubTitle:{left:540,top:1048}}},settings:{font:{title:{size:60,bold:!0}},e:{button:{width:540,height:640,fontLeft:270,fontTop:320}}},end:{font:{gameName:{size:37},coin:{size:43,bold:!0},mode:{size:120},sub:{size:40,bold:!0},score:{size:170,bold:!0},scoreSub:{size:78,bold:!0},title:{size:78},ver:{size:33}},e:{gameName:{left:10,top:28},coin:{left:1070,top:28},mode:{left:540,top:384},score:{left:540,top:790},scoreSub:{left:540,top:970},share:{left:306,top:1324},exit:{left:540,top:1324},again:{left:774,top:1324},ver:{left:22,top:1843}}}},this.flags={language:"zh-cn",sound:0,lastMode:{}},this.pageData={},this.state={},this.eventState={},this.handlers={},this.logList={tip:{text:"",alpha:0}},this.disableInput={t:(new Date).getTime(),l:700}};game.prototype={init:function(){this._prepareAPI(),this._addEventListner(),this.getScroll(),this.resize(),this.initGameData(),this.main(),this.drawTip("已载入")},_prepareAPI:function(){var e=this,t=e.cid;e.canvas=document.getElementById(t),e.c2d=e.canvas.getContext("2d"),e.score.coin=e.score.coin||0,e.flags.language=e.flags.language||"zh-cn",e.flags.sound=e.flags.sound||0,e.score.bestScore={},e.score.gamesPlayed={},e.score.tilesCollected={};for(var o in e.rule){e.score.bestScore[o]=[],e.score.gamesPlayed[o]=[],e.score.tilesCollected[o]=[],e.flags.lastMode[o]=0;for(var r in e.rule[o].sub)e.score.bestScore[o][r]=0,e.score.gamesPlayed[o][r]=0,e.score.tilesCollected[o][r]=0}e.score.leaderboard={arcade:new Array(5),rush:new Array(5)},e.load(),e.dom.dReturn.onclick=function(){e.tolastDomPage()},e.dom.dReset.onclick=function(){e.resetSave()},window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext;try{e.audioContext=new AudioContext}catch(e){console.log(e+"\n!Your browser does not support AudioContext")}"file:"==window.location.href.slice(0,5)&&(e.audioContext=null);var i;if(e.audioContext){var a,s=e.audioContext;for(var o in e.sound)i=e.sound[o],e.sound[o]={},a=e.sound[o],function(e,t){var o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="arraybuffer",o.onload=function(){e.file=o.response,s.decodeAudioData(e.file,function(t){e.buffer=t},function(e){console.log("音频文件解码失败：(")})},o.send()}(a,i)}else for(var o in e.sound)i=e.sound[o],e.sound[o]={},e.sound[o].audio=new Audio,e.sound[o].audio.src=i},_addEventListner:function(){var e=this,t=e.canvas,o=(e.dom,e.state),r=e.eventState,i=e.handlers;i.resize=function(){o.resize=!0},i.onscroll=function(){o.onscroll=!0},i.setClickMsg=function(t,i){if(i=i||event,i.preventDefault(),"mouse"===t.slice(0,5))r[t]||(r[t]=[],r[t][0]={}),r[t][0].clientX=e.getClientX(i.clientX),r[t][0].clientY=e.getClientY(i.clientY),o[t]=!0;else{r[t]?r[t].splice(0,r[t].length):r[t]=[];for(var a=i.changedTouches,s=0;s<a.length;s++)r[t][s]||(r[t][s]={}),r[t][s].clientX=e.getClientX(a[s].clientX),r[t][s].clientY=e.getClientY(a[s].clientY);o[t]=!0}},i.mousedown=function(e){i.setClickMsg("mousedown",e)},i.mouseup=function(e){i.setClickMsg("mouseup",e)},i.mousemove=function(e){i.setClickMsg("mousemove",e)},i.touchstart=function(e){i.setClickMsg("touchstart",e)},i.touchend=function(e){i.setClickMsg("touchend",e)},i.touchmove=function(e){i.setClickMsg("touchmove",e)},window.addEventListener("resize",i.resize,!1),window.addEventListener("scroll",i.onscroll,!1),t.addEventListener("mousedown",i.mousedown,!1),t.addEventListener("mousemove",i.mousemove,!1),t.addEventListener("mouseup",i.mouseup,!1),t.addEventListener("touchstart",i.touchstart,!1),t.addEventListener("touchmove",i.touchmove,!1),t.addEventListener("touchend",i.touchend,!1)},getCurrScore:function(){var e=this,t=e.b,o=Number(e.score.bestScore[t.mode][t.sub]),r=t.run.currScore,i=t.run,a=e.language[e.flags.language],s={best:a.best,newBest:a.newBest,failed:a.failed};switch(i.rule.tip){case"playTime":r.score=i.score<i.rule.max?s.failed:(i.time.currRun/1e3).toFixed(3)+e.language.misc.symbol[1],i.score>=i.rule.max&&(0==o&&0!=i.time.currRun||0!=o&&i.time.currRun<o)?r.scoreTip=s.newBest:r.scoreTip=s.best+e.language.misc.symbol[4]+(o/1e3).toFixed(3)+e.language.misc.symbol[1];break;case"timeLeft":case"block":r.score=i.score.toString(),o<i.score?r.scoreTip=s.newBest:r.scoreTip=s.best+e.language.misc.symbol[4]+o.toString();break;case"speed":r.score=i.speed.toFixed(3)+e.language.misc.symbol[2],o<i.speed?r.scoreTip=s.newBest:r.scoreTip=s.best+e.language.misc.symbol[4]+o.toFixed(3)+e.language.misc.symbol[2]}},summary:function(){var e=this,t=e.b,o=t.run,r=t.mode,i=t.sub,a=Number(e.score.bestScore[t.mode][t.sub]);switch(e.getCurrScore(),o.rule.tip){case"playTime":o.score>=o.rule.max&&(0==a&&0!=o.time.currRun||0!=a&&o.time.currRun<a)&&(e.score.bestScore[r][i]=o.time.currRun);break;case"timeLeft":case"block":a<o.score&&(e.score.bestScore[r][i]=o.score);break;case"speed":a<o.speed&&(e.score.bestScore[r][i]=o.speed)}switch(e.score.gamesPlayed[r][i]=parseInt(e.score.gamesPlayed[r][i])+1,e.score.tilesCollected[r][i]=parseInt(e.score.tilesCollected[r][i])+o.score,r){case"arcade":e.score.leaderboard.arcade.push(o.score),e.score.leaderboard.arcade.sort(sortNumber),e.score.leaderboard.arcade.pop();break;case"rush":e.score.leaderboard.rush.push(o.speed),e.score.leaderboard.rush.sort(sortNumber),e.score.leaderboard.rush.pop()}e.score.coin=parseInt(e.score.coin)+o.score,e.flags.lastMode[r]=i,e.rerun(),e.save()},save:function(){this.saveFile("score",this.score),this.saveFile("flags",this.flags)},load:function(){this.score=this.loadFile("score",this.score),this.flags=this.loadFile("flags",this.flags);var e=this;if(e.score.tilesColected){if(delete e.score.tilesColected,!e.score.tilesCollected){e.score.tilesCollected={};for(var t in e.rule){e.score.tilesCollected[t]=[];for(var o in e.rule[t].sub)e.score.tilesCollected[t][o]=0}}e.save()}},saveFile:function(e,t){return setLocalStorage(this.name+"_"+e,t)},loadFile:function(e,t){return getLocalStorage(this.name+"_"+e,t)},removeFile:function(e){return removeLocalStorage(this.name+"_"+e)},clearFile:clearLocalStorage,drawTip:function(e){var t=this,o=t.logList.tip;if(e&&(o.text=e,o.hideFrame=t.style.tip.hideFrame),o.text){var r,i,a=(t.dom.width,t.c2d),s=t.style.tip,l=o.hideFrame,n=l>18?1:l/18,c={bg:"rgba("+s.color.bg+","+.9*n+")",text:"rgba("+s.color.text+","+n+")"};a.font=s.font,a.textAlign="left",a.textBaseline="top",i=s.fontSize+2.5*s.top,r=a.measureText(o.text).width+2*s.left,a.fillStyle=c.bg,a.fillRect(s.left,s.top,r,i),a.fillStyle=c.text,a.fillText(o.text,s.fontLeft,s.fontTop),o.hideFrame=Math.max(0,l-1),o.hideFrame<=0&&(o.text="")}},setPageData:function(e){var t,o=this,r=o.pageData,i=o.language[o.flags.language],a=o.dom,s=a.width,l=a.height,n=o.b.run.rule.block||4,c=o.style;if(t="menu",!e||e===t){r[t]||(r[t]={}),r[t].TitleList=[];for(var u in i.modeList)i.modeList.hasOwnProperty(u)&&r[t].TitleList.push(i.modeList[u][0]);r[t].TitleList.length%2||r[t].TitleList.push(i.randomMode),r[t].TitleList.push(i.settings),c[t].font&&o.autoFontStyle(r[t],c[t].font),c[t].e&&o.autoElementStyle(r[t],c[t].e)}if(t="game",!e||e===t){r[t]||(r[t]={}),r[t].subTitle={};for(var u in i.modeList)i.modeList.hasOwnProperty(u)&&(r[t].subTitle[u]=i.modeList[u][1]);r[t].startTitle=i.start,r[t].TitleList={endGame:i.endGame,playOn:i.playOn,errorTip:i.errorTip,best:i.best,newBest:i.newBest},c[t].font.start.size=parseInt(1080/n/3),c[t].font&&o.autoFontStyle(r[t],c[t].font),c[t].e.blockTip.left=parseInt(1080/n/2),c[t].e.blockTip.top=parseInt(1920/n/2),c[t].e&&o.autoElementStyle(r[t],c[t].e),o.b.width=Math.ceil(s/n),o.b.height=Math.ceil(l/n)}if(t="settings",!e||e===t){r[t]||(r[t]={}),r[t].TitleList=[i.back,i.leaderboard,i.profile,i.sound,i.language,i.about],r[t].soundTitle=i.soundList,r[t].languageTitle||(r[t].languageTitle={});for(var u=0;u<o.language.list.length;u++)r[t].languageTitle[o.language.list[u]]=o.language[o.language.list[u]].languageName;c[t].font&&o.autoFontStyle(r[t],c[t].font),r[t].listNum=r[t].TitleList.length,r[t].row=Math.ceil(r[t].listNum/2),c[t].e&&o.autoElementStyle(r[t],c[t].e)}t="end",e&&e!==t||(r[t]||(r[t]={}),r[t].TitleList={gameName:i.gameName,share:i.share,exit:i.exit,again:i.again,best:i.best,newBest:i.newBest,ver:i.ver},c[t].font&&o.autoFontStyle(r[t],c[t].font),c[t].e&&o.autoElementStyle(r[t],c[t].e))},setMiscStyle:function(){var e=this,t=e.style,o=e.dom.width;e.dom.height;t.tip||(t.tip={});var r=t.tip;r.left=parseInt(.01*o),r.top=r.left,r.fontLeft=2*r.left,r.fontTop=2*r.top,r.fontSize=parseInt(o/30),r.font=r.fontSize+"px "+t.fontName,r.color={bg:"34,34,34",text:"255,255,255"},r.hideFrame=120},autoFontStyle:function(e,t){e.font||(e.font={}),e.fontSize||(e.fontSize={});var o,r=this.style.scale.width,i=this.style.fontName;for(var a in t)t.hasOwnProperty(a)&&(o=parseInt(t[a].size*r),e.fontSize[a]=o,e.font[a]=(t[a].bold?"bold ":"")+o+"px "+i)},autoElementStyle:function(e,t){e.e||(e.e={});var o,r=this.style.scale.width,i=this.style.scale.height;for(var a in t)if(t.hasOwnProperty(a)){e.e[a]||(e.e[a]={});for(var s in t[a])if(t[a].hasOwnProperty(s)){switch(s){case"width":case"left":case"fontLeft":case"radius":o=r;break;case"height":case"top":case"fontTop":case"fontTopB":o=i;break;default:o=1}e.e[a][s]=Math.ceil(t[a][s]*o)}}},getScroll:function(){this.dom.scrollLeft=document.documentElement.scrollLeft,this.dom.scrollTop=document.documentElement.scrollTop},getClientX:function(e){return e-this.dom.offsetLeft+this.dom.scrollLeft},getClientY:function(e){return e-this.dom.offsetTop+this.dom.scrollTop},ifOneColumn:function(e,t){return-1!=e&&-1!=t&&(e==t||e+2==t||e-2==t)},calcMiddleColor:function(e,t,o){isset(t)||(t=1);var r,i,a={r:0,g:0,b:0},s=1/(e.length-1),l=0,n=t;n>1&&(n=n%1==0?1:n%1);do{r=e[l],i=e[l+1],1!=++l&&s<n&&(n-=s)}while(s<n);n/=s;for(var c in a)a.hasOwnProperty(c)&&(r[c]>=i[c]?a[c]=r[c]-Math.round((r[c]-i[c])*n):a[c]=i[c]+Math.round((r[c]-i[c])*(1-n)));return isset(o)?"rgba("+a.r+","+a.g+","+a.b+","+o+")":"rgb("+a.r+","+a.g+","+a.b+")"},setblock:function(e,t,o,r){e.pos=t,e.on=o,e.frame=r},setblockList:function(e,t){for(var o,r,i,a=this,s=a.b.run,l=s.rule.two,n=s.rule.pro,c=e+t,u=s.list,d=s.rule.block,f=d/2,m=s.listMax,g=new Array(2),h=e;h<c;h++)i=Math.random(),o=parseInt(h%m),g[0]=parseInt(i*d),n&&(r=(o+m-1)%m,(a.ifOneColumn(g[0],u[r][0].pos)||a.ifOneColumn(g[0],u[r][1].pos))&&(g[0]>f?g[0]--:g[0]++)),g[1]=l&&i>.83?(g[0]+2)%d:-1,a.setblock(u[o][0],g[0],!1,0),a.setblock(u[o][1],g[1],!1,0)},randomSub:function(e){if(e instanceof Array||e.constructor===String)return e[parseInt(Math.random()*e.length)];if(e instanceof Object){var t=Object.keys(e);return e[t[parseInt(Math.random()*t.length)]]}},resize:function(){var e,t,o=this,r=o.dom,i=o.canvas;r.htmlWidth=getClientWidth(),r.htmlHeight=getClientHeight(),e=r.htmlWidth,t=r.htmlHeight,t/e<1.3&&(e=parseInt(t/1.3)),i.width=e,i.height=t,r.width=e,r.height=t,r.offsetLeft=i.offsetLeft,r.offsetTop=i.offsetTop,r.domList.style.width=e+"px",r.domList.style.height=t+"px",r.domList.style.left=r.offsetLeft+"px",r.domList.style.top=r.offsetTop+"px",r.domList.style.fontSize=parseInt(e/20)+"px",r.dTop.style.height=parseInt(.12*e)-1+"px",r.dContent.style.height=t-parseInt(.12*e)+"px",o.style.scale.width=e/o.style.width,o.style.scale.height=t/o.style.height,o.setPageData(),o.setMiscStyle()},rerun:function(){var e=this,t=e.b.run,o=t.rule;t.gameStart=!1,t.errorState=!1,t.subScoll.on=!1,t.subScoll.startTime=0,t.subScoll.startPos=0,t.subScoll.startLeft=0,t.subScoll.startTop=0,t.subScoll.subWidth=e.pageData.game.e.sub.width+e.pageData.game.e.sub.marginRight;for(var r in t.time)t.time[r]=0;t.list=[],t.listMax=o.block+2;for(var r=0;r<t.listMax;r++)t.list[r]=[],t.list[r][0]={pos:-1,on:!1,frame:0},t.list[r][1]={pos:-1,on:!1,frame:0};t.listPos=0,t.runPos=0,t.score=0,t.timeLeft=1e3*o.timeMax||0,t.speed=0,t.pause=!0,t.error={listPos:-1,pos:-1,frame:0,coinDemand:0,errorTip:""},t.errorNum=0,t.endColor=t.endColor||e.style.game.color.block,t.placeholder=Math.ceil(o.block/5),t.lastPos=t.placeholder},loadRule:function(e,t){var o=this.rule[e],r=o.sub[t],i=this.b.run.rule;for(var a in o)"sub"!=a&&o.hasOwnProperty(a)&&(i[a]=o[a]);for(var a in r)r.hasOwnProperty(a)&&(i[a]=r[a])},initGameData:function(e,t,o){e=e||"classic",t=t||0;var r=this,i=r.b,a=i.run,s=a.rule;r.loadRule(e,t),i.mode=e,i.sub=t,o&&(i.subPos=Math.max(0,t-1)),i.width=Math.ceil(r.dom.width/s.block),i.height=Math.ceil(r.dom.height/s.block),r.rerun(),r.setblockList(a.placeholder,a.listMax-a.placeholder),r.setPageData("game")},runGameData:function(){if(this.b.run.gameStart&&!this.b.run.pause){var e,t,o,r,i,a,s,l=this,n=l.b,c=n.run,u=c.time;switch(t=(new Date).getTime(),u.start||(u.start=t,u.run=0,u.currRun=0,u.last=t,u.curr=t,u.interval=0,c.speed=c.rule.speed||0),e=u.curr,o=Math.min(n.frameTimeMax,t-e),c.rule.require){case"time":case"loop":u.currRun+o>=c.timeLeft&&(l.playSound("timeEnd"),c.endColor=l.style.game.color.block,l.summary(),l.switchPage(l.page,"end"))}if(r=c.listPos+c.runPos,a=c.listPos,c.rule.scroll)i=r+c.speed*o/1e3,c.speed+=c.rule.speedup*o/1e3,c.rule.speedMax&&(c.speed=Math.min(c.speed,c.rule.speedMax));else{i=r,s=parseInt(i);for(var d,f=c.placeholder;f<c.listMax&&-1!=(d=l.checkRowFrame(f+s));f++){var m=d/n.clickTime;i=f+s-c.placeholder+(m>.5?1-(1-m)*(1-m)*2:m*m*2)}}s=parseInt(i),l.checkList(a,s-a)?(c.listPos=(c.lastPos-1+c.listMax)%c.listMax,c.runPos=0,l.playSound("error"),c.errorNum<2?(c.errorNum++,c.error.coinDemand=(c.score<100?100:c.score)*Math.pow(2,c.errorNum),c.error.errorTip=l.randomSub(l.pageData.game.TitleList.errorTip),c.errorState=!0,c.pause=!0,l.getCurrScore(),l.disableEventInput(600)):(c.endColor=l.style.game.color.block,l.summary(),l.switchPage(l.page,"end"))):(c.listPos=s%c.listMax,c.runPos=i%1,l.setblockList((a-1+c.listMax)%c.listMax,s-a)),u.run=t-u.start,u.currRun+=o,u.last=u.curr,u.curr=t,u.interval=o}},clickBlock:function(e,t,o){var r,i=this,a=i.b.run,s=a.lastPos,l=!0;if(r=o>.5?e+1:e-1,r=(r+a.listMax)%a.listMax,e==s||r==s){for(var n=0;n<2;n++)if(a.list[s][n].pos==t&&(l=!1,!a.list[s][n].on)){switch(a.list[s][n].on=!0,a.score=parseInt(a.score)+1,i.playSound("click"),a.rule.require){case"block":a.score>=a.rule.max&&(a.endColor=i.style.game.color.victory,i.summary(),i.switchPage(i.page,"end"));break;case"loop":a.score>=a.rule.max&&a.score%a.rule.max==0&&(a.time.currRun=0)}return 1}if(l&&e==s)return a.error.listPos=e,a.error.pos=t,a.error.frame=0,2}return 0},checkRow:function(e){e%=this.b.run.listMax;for(var t=this.b.run.list[e],o=0;o<2;o++)if(-1!=t[o].pos&&!t[o].on)return!0;return!1},checkRowFrame:function(e){e%=this.b.run.listMax;for(var t=this.b.run.list[e],o=-1,r=0;r<2;r++)if(-1!=t[r].pos){if(!t[r].on){o=-1;break}o=-1==o?t[r].frame:Math.min(o,t[r].frame)}return o},checkList:function(e,t){for(var o=e+t,r=(this.b.run.listMax,e);r<o;r++)if(this.checkRow(r))return!0;return!1},switchLanguage:function(e){var t=this,o=e,r=t.language;if(!o){var i=t.flags.language,a=r.list;if(i)for(var s in a)if(a[s]===i){o=a[(parseInt(s)+1)%a.length];break}}o&&r[o]||(o=r.list[0]),t.flags.language=o,t.setPageData()},switchSound:function(){this.flags.sound=this.flags.sound?0:1},switchPage:function(e,t){var o=this;o.page=t,o.disableEventInput(350),"end"==t&&o.b.run.currScore.scoreTip==o.language[o.flags.language].newBest&&o.playSound("victory")},switchDomPage:function(e){var t=this,o=t.dom,r=t.language[t.flags.language],i=!1;switch(e){case"leaderboard":case"profile":i=!0;case"bestScore":case"gamesPlayed":case"tilesCollected":case"about":t.domPage=e,o.domList.style.display="block",t.setDomPage(r[e],i,e);break;default:t.domPage="",o.domList.style.display="none"}},setDomPage:function(e,t,o){var r=this,i=r.dom,a=r.language[r.flags.language];for(i.dTopTitle.innerText=e,i.dReset.style.display=t?"block":"none";i.dContent.childNodes[0];)i.dContent.removeChild(i.dContent.childNodes[0]);if("leaderboard"==o){var s=r.score.leaderboard;for(var l in s){var n,c,u,d,f=new Array;c=r.createE("div","dTitle",[r.createE("div","dLeft",[r.createE("span",null,[r.createText(a.modeList[l][0])])])]);for(var m=0;m<s[l].length;m++)d=s[l][m]||0,f[m]=r.createE("span",null,[r.createE("div","dLeft",[r.createE("span",null,[r.createText(m)])]),r.createE("div","dRight",[r.createE("span","dSubVal",[r.createText(r.getModeScore(l,d))])])]);u=r.createE("div","dSub",f),n=r.createE("div","dc",[c,u]),i.dContent.appendChild(n)}}if("profile"==o){var n,u,g=["bestScore","gamesPlayed","tilesCollected"],h=new Array;for(var l in g){var p,b=g[l];p=r.createE("div","button"),p.key=b,p.onclick=function(){r.switchDomPage(this.key)},h[l]=r.createE("span",null,[p,r.createE("div","dLeft",[r.createE("span",null,[r.createText(a[b])])]),r.createE("div","dRight",[r.createE("span","dLinkSymbol",[r.createText(">")])])])}u=r.createE("div","dSub",h),n=r.createE("div","dc",[u]),i.dContent.appendChild(n)}if("about"==o){var n,u,v={},w={},T={},g=["umoni","bilibili","weibo"];for(var l in g)v[g[l]]=r.createE("a","button"),v[g[l]].href=r.language.misc[g[l]+"URL"],w[g[l]]=r.img[g[l]],T[g[l]]=r.createE("span",null,[v[g[l]],r.createE("div","dLeft",[w[g[l]],r.createE("span",null,[r.createText("umoni"==g[l]?a.thanks:a[g[l]])])]),r.createE("div","dRight",[r.createE("span","dLinkTitle",[r.createText("umoni"==g[l]?a.thanksFor:r.language.misc[g[l]+"Name"])]),r.createE("span","dLinkSymbol",[r.createText(">")])])]);n=r.createE("div","dc",[r.createE("div","dSub",[T.umoni])]),i.dContent.appendChild(n),n=r.createE("div","dc",[r.createE("div","dTitle",[r.createE("div","dLeft",[r.createE("span",null,[r.createText(a.contact)])])]),r.createE("div","dSub",[T.bilibili,T.weibo]),r.createE("div","dAboutTip",[r.createText(a.subscribe)])]),i.dContent.appendChild(n)}if("bestScore"==o||"gamesPlayed"==o||"tilesCollected"==o){var n,c,u,T,d,x,S=r.score[o];for(var l in S){T=new Array,x=0;for(var m in S[l])"bestScore"==o?d=r.getModeScore(l,S[l][m]):(d=S[l][m]||0,x+=d),T[m]=r.createE("span",null,[r.createE("div","dLeft",[r.createE("span",null,[r.createText(a.modeList[l][1][m])])]),r.createE("div","dRight",[r.createE("span","dSubVal",[r.createText(d)])])]);c="bestScore"==o?r.createE("div","dTitle",[r.createE("div","dLeft",[r.createE("span",null,[r.createText(a.modeList[l][0])])])]):r.createE("div","dTitle",[r.createE("div","dLeft",[r.createE("span",null,[r.createText(a.modeList[l][0])])]),r.createE("div","dRight",[r.createE("span",null,[r.createText(x)])])]),u=r.createE("div","dSub",T),n=r.createE("div","dc",[c,u]),i.dContent.appendChild(n)}}},tolastDomPage:function(){var e=this;switch(e.domPage){case"bestScore":case"gamesPlayed":case"tilesCollected":e.switchDomPage("profile");break;case"leaderboard":case"profile":case"about":default:e.switchDomPage()}},resetSave:function(){var e=this.language[this.flags.language].reScore;if(confirm(e)){var t=this;t.score.bestScore={},t.score.gamesPlayed={},t.score.tilesCollected={};for(var o in t.rule){t.score.bestScore[o]=[],t.score.gamesPlayed[o]=[],t.score.tilesCollected[o]=[];for(var r in t.rule[o].sub)t.score.bestScore[o][r]=0,t.score.gamesPlayed[o][r]=0,t.score.tilesCollected[o][r]=0}t.score.leaderboard={arcade:new Array(5),rush:new Array(5)},t.save(),t.switchDomPage(t.domPage)}},createE:function(e,t,o){var r=document.createElement(e);isset(t)&&(r.className=t);for(var i in o)r.appendChild(o[i]);return r},createText:function(e){return document.createTextNode(e)},getModeScore:function(e,t){switch(t=t||0,this.rule[e].tip){case"playTime":return(t/1e3).toFixed(3)+this.language.misc.symbol[1];case"speed":return t.toFixed(3)+this.language.misc.symbol[2];case"timeLeft":case"block":default:return t.toString()}},playSound:function(e){var t=this,o=t.sound[e];if(o&&0==t.flags.sound)if(t.audioContext){var r=t.audioContext,i=r.createBufferSource();i.connect(r.destination),i.buffer=o.buffer,i.start(0)}else o.audio.currentTime=0,o.audio.play()},disableEventInput:function(e){return this.disableInput.l=e||600,this.disableInput.t=(new Date).getTime()},execution:function(e){var t=this,o=t.state,e=e||t.page,r=(new Date).getTime();if(o.resize&&(t.resize(),o.resize=!1),o.onscroll&&(t.getScroll(),o.onscroll=!1),t.disableInput.t<r-t.disableInput.l)switch(e){case"menu":t.eventMenu();break;case"game":t.eventGame();break;case"settings":t.eventSettings();break;case"end":t.eventEnd();break;default:t.page="menu",t.eventMenu()}for(var i in o)o.hasOwnProperty(i)&&(o[i]=!1)},eventMenu:function(){var e=this.state.touchend?"touchend":this.state.mouseup?"mouseup":"";if(e){var t,o,r,i,a,s=this,l=s.eventState;if(r=s.pageData.menu.e.button.width,i=s.pageData.menu.e.button.height,t=l[e][0].clientX,o=l[e][0].clientY,a=Math.max(0,Math.ceil(t/r)-1)+2*Math.max(0,Math.ceil(o/i)-1),s.state[e]=!1,a<s.language.misc.mode.length){var n=s.language.misc.mode[a];s.initGameData(n,s.flags.lastMode[n],!0),s.switchPage(s.page,"game")}else s.switchPage(s.page,"settings")}},eventGame:function(){var e,t,o=this,r=o.eventState,i=o.b,a=i.run,s=this.state.touchstart?"touchstart":this.state.mousedown?"mousedown":"";if(s&&!a.subScoll.on&&!a.errorState){if(!a.gameStart&&(e=r[s][0].clientX,t=r[s][0].clientY,o.dom.height-t<o.pageData.game.e.sub.height)){var l=a.subScoll;l.on=!0,l.startTime=(new Date).getTime(),l.startPos=i.subPos,l.startLeft=e,l.startTop=t}if(!a.subScoll.on)for(var n=0;n<r[s].length;n++){e=r[s][n].clientX,t=r[s][n].clientY;var c=((o.dom.height-t)/i.height+a.listPos+a.runPos)%a.listMax,u=Math.max(0,Math.ceil(e/i.width)-1);switch(o.clickBlock(parseInt(c),u,c%1)){case 0:break;case 1:a.gameStart||(a.gameStart=!0),a.pause&&(a.pause=!1);for(var d=0;d<a.listMax&&!o.checkRow(a.lastPos);d++)a.lastPos=(a.lastPos+1)%a.listMax;break;case 2:o.playSound("error"),a.errorNum<2?(a.errorNum++,a.error.coinDemand=(a.score<100?100:a.score)*Math.pow(2,a.errorNum),a.error.errorTip=o.randomSub(o.pageData.game.TitleList.errorTip),a.endColor=o.style.game.color.error,a.errorState=!0,a.pause=!0,o.getCurrScore(),o.disableEventInput(600)):(o.summary(),o.switchPage(o.page,"end"))}}}var s=this.state.touchmove?"touchmove":this.state.mousemove?"mousemove":"";s&&a.subScoll.on&&!a.errorState&&(e=r[s][0].clientX,i.subPos=Math.max(-1,(a.subScoll.startLeft-e)/a.subScoll.subWidth+a.subScoll.startPos),i.subPos=Math.min(i.subPos,o.pageData.game.subTitle[i.mode].length-1));var s=this.state.touchend?"touchend":this.state.mouseup?"mouseup":"";if(s){if(a.subScoll.on){a.subScoll.on=!1,e=r[s][0].clientX,t=r[s][0].clientY;var f,m=(new Date).getTime()-a.subScoll.startTime,g=.1*a.subScoll.subWidth;m<300&&Math.abs(e-a.subScoll.startLeft)<g&&Math.abs(t-a.subScoll.startTop)<g&&(f=parseInt(a.subScoll.startLeft/a.subScoll.subWidth+i.subPos),i.sub!=f&&f>=0&&f<o.pageData.game.subTitle[i.mode].length&&(i.sub=f,o.initGameData(i.mode,i.sub)))}if(a.errorState){e=r[s][0].clientX,t=r[s][0].clientY;var h=o.pageData.game.e,p=h.buttonOut,b=h.buttonGo;t>p.top&&t<p.top+p.height&&(e>p.left&&e<p.left+p.width&&(o.summary(),o.switchPage(o.page,"end")),e>b.left&&e<b.left+b.width&&(parseInt(o.score.coin)>=a.error.coinDemand?(a.errorState=!1,a.error.listPos=-1,a.error.pos=-1,o.score.coin=parseInt(o.score.coin)-a.error.coinDemand):a.error.errorTip=o.language[o.flags.language].errorTipCoin))}}},eventSettings:function(){var e=this.state.touchend?"touchend":this.state.mouseup?"mouseup":"";if(e){
var t,o,r,i,a,s=this,l=s.eventState;switch(r=s.pageData.settings.e.button.width,i=s.pageData.settings.e.button.height,t=l[e][0].clientX,o=l[e][0].clientY,a=Math.max(0,Math.ceil(t/r)-1)+2*Math.max(0,Math.ceil(o/i)-1),s.state[e]=!1,a){case 0:s.switchPage(s.page,"menu");break;case 1:s.switchDomPage("leaderboard");break;case 2:s.switchDomPage("profile");break;case 3:s.switchSound(),s.save();break;case 4:s.switchLanguage(),s.save();break;case 5:s.switchDomPage("about")}}},eventEnd:function(){var e=this.state.touchend?"touchend":this.state.mouseup?"mouseup":"";if(e){var t,o,r,i,a,s,l,n,c=this,u=c.eventState;if(r=c.pageData.end.e.share.left,i=c.pageData.end.e.share.top,a=2*c.pageData.end.fontSize.title,s=c.pageData.end.fontSize.title,l=c.pageData.end.e.exit.left-c.pageData.end.e.share.left,r-=a/2,i-=s/2,t=u[e][0].clientX,(o=u[e][0].clientY)>=i&&o<=i+s&&t>=r&&t<=r+3*l){var d=(t-r)%l,f=parseInt((t-r)/l);d<=a&&(n=f)}if(c.state[e]=!1,isset(n))switch(n){case 0:try{window.open("about:blank","image").document.write("<title>请保存图片</title><h1>可保存该图片，本页面不消耗流量</h1><img src='"+c.canvas.toDataURL("image/png")+"' alt='炫耀'/>")}catch(e){c.drawTip("弹出窗口被拦截，请同意弹窗或使用第三方软件截取游戏画面")}break;case 1:c.switchPage(c.page,"menu");break;case 2:var m=c.b.mode;c.initGameData(m,c.flags.lastMode[m]),c.switchPage(c.page,"game")}}},drawInterface:function(e){var t=this;switch(e=e||t.page){case"menu":t.drawMenu();break;case"game":t.drawGame();break;case"settings":t.drawSettings();break;case"end":t.drawEnd();break;default:t.page="menu",t.drawMenu()}},drawMenu:function(){var e=this,t=e.c2d,o=e.style,r=e.pageData.menu,i=r.TitleList,a=r.e.button.width,s=r.e.button.height,l=r.e.button.fontLeft,n=r.e.button.fontTop,c=r.font;t.fillStyle=o.color.normal,t.fillRect(0,0,e.dom.width,e.dom.height),t.fillStyle=o.color.reverse,t.fillRect(a,0,a,s),t.fillRect(0,s,a,s),t.fillStyle=o.menu.color.settings,t.fillRect(a,2*s,a,s),t.font=c.title,t.textAlign="center",t.textBaseline="middle",t.fillStyle=o.color.reverse,t.fillText(i[0],l,n),t.fillText(i[3],l+a,n+s),t.fillText(i[4],l,n+2*s),t.fillStyle=o.color.normal,t.fillText(i[1],l+a,n),t.fillText(i[2],l,n+s),t.fillText(i[5],l+a,n+2*s),t.fillStyle=o.menu.color.settings,t.font=c.coin,t.textAlign="right",t.textBaseline="top",t.fillText(e.score.coin+e.language.misc.symbol[0],r.e.coin.left,r.e.coin.top)},drawGame:function(){for(var e=this,t=e.c2d,o=e.dom.width,r=e.dom.height,i=e.pageData.game,a=e.b,s=a.run,l=i.font,n=i.TitleList,c=e.style.game.color,u=[],d=[],f=[],m={},g=[],h=[],p=0;p<s.rule.block;p++)g[p]=p*a.width;for(var p=0;p<s.listMax;p++){u[p]=parseInt((p+s.listPos)%s.listMax),h[p]=r-(p+1)*a.height+parseInt(s.runPos*a.height),d[p]=[],f[p]=[];for(var b=0;b<2;b++)d[p][b]={},f[p][b]={},-1!=s.list[u[p]][b].pos&&(d[p][b].left=g[s.list[u[p]][b].pos],d[p][b].top=h[p],s.list[u[p]][b].on&&(f[p][b].width=parseInt(a.width*Math.min(1,.8+s.list[u[p]][b].frame/12*.2)),f[p][b].height=parseInt(a.height*Math.min(1,.8+s.list[u[p]][b].frame/12*.2)),f[p][b].left=d[p][b].left+parseInt((a.width-f[p][b].width)/2),f[p][b].top=d[p][b].top+parseInt((a.height-f[p][b].height)/2),s.list[u[p]][b].frame<a.clickTime&&s.list[u[p]][b].frame++))}-1!=s.error.listPos&&-1!=s.error.pos&&(m.left=s.error.pos*a.width,m.top=h[(s.error.listPos-s.listPos+s.listMax)%s.listMax]),t.fillStyle=c.bg,t.fillRect(0,0,o,r),t.fillStyle=c.block;for(var p=0;p<s.listMax;p++)for(var b=0;b<2;b++)-1!=s.list[u[p]][b].pos&&t.fillRect(d[p][b].left,d[p][b].top,a.width,a.height);t.fillStyle=c.onblock;for(var p=0;p<s.listMax;p++)for(var b=0;b<2;b++)-1!=s.list[u[p]][b].pos&&s.list[u[p]][b].on&&t.fillRect(f[p][b].left,f[p][b].top,f[p][b].width,f[p][b].height);-1!=s.error.listPos&&-1!=s.error.pos&&(t.fillStyle=c.error,t.fillRect(m.left,m.top,a.width,a.height)),t.lineWidth=1,t.strokeStyle=c.line,t.beginPath();for(var p=0;p<s.rule.block;p++)t.moveTo(g[p]-.5,0),t.lineTo(g[p]-.5,r);for(var p=0;p<s.listMax;p++)t.moveTo(0,h[p]-.5),t.lineTo(o,h[p]-.5);if(t.stroke(),"block"==s.rule.require&&s.rule.max<=s.score+s.rule.block-s.placeholder){var b=s.rule.max+(s.placeholder-1)-s.score+(s.lastPos-s.listPos-s.placeholder+s.listMax)%s.listMax;t.fillStyle=c.victory,t.fillRect(0,0,o,h[b])}if("none"!=s.rule.progressBar){var v;switch(s.rule.progressBar){case"block":v=s.score/s.rule.max;break;case"timeLeft":v=(s.timeLeft-s.time.currRun)/s.timeLeft;break;case"loop":v=s.score%s.rule.max/s.rule.max}t.fillStyle=e.calcMiddleColor(c.ProgressBar,v),t.fillRect(0,0,parseInt(o*v),2),t.fillStyle=c.ProgressBarS,t.fillRect(0,2,parseInt(o*v),2)}var w="";switch(s.rule.tip){case"playTime":w=(s.time.currRun/1e3).toFixed(3)+e.language.misc.symbol[1];break;case"block":w=s.score.toString();break;case"speed":w=s.speed.toFixed(3)+e.language.misc.symbol[2];break;case"timeLeft":w=((s.timeLeft-s.time.currRun)/1e3).toFixed(3)+e.language.misc.symbol[1]}switch(t.font=l.gameTip,t.textAlign="center",t.textBaseline="middle",t.fillStyle=c.gameTipS,t.fillText(w,i.e.gameTip.left+2,i.e.gameTip.top+2),s.rule.tip){case"timeLeft":var v=(s.timeLeft-s.time.currRun)/s.timeLeft;t.fillStyle=e.calcMiddleColor(c.ProgressBar,v);break;default:t.fillStyle=c.gameTip}if(t.fillText(w,i.e.gameTip.left,i.e.gameTip.top),s.pause)for(var p=0;p<s.listMax;p++)if(-1!=s.list[u[p]][0].pos&&!s.list[u[p]][0].on||-1!=s.list[u[p]][1].pos&&!s.list[u[p]][1].on){t.font=l.start,t.fillStyle=e.style.color.normal,t.textAlign="center",t.textBaseline="middle";for(var b=0;b<2;b++)-1==s.list[u[p]][b].pos||s.list[u[p]][b].on||t.fillText(i.startTitle,d[p][b].left+i.e.blockTip.left,d[p][b].top+i.e.blockTip.top);break}if(!s.gameStart){for(var T=[],x=i.subTitle[a.mode],S=i.e.sub.width+i.e.sub.marginRight,p=0;p<x.length;p++)T[p]={},T[p].left=parseInt((p-a.subPos)*S),T[p].top=r-i.e.sub.height,T[p].fontLeft=T[p].left+i.e.sub.fontLeft,T[p].fontTop=T[p].top+i.e.sub.fontTop;t.fillStyle=c.subBg;for(var p=0;p<x.length;p++)T[p].left+S>=0&&T[p].left<=o&&t.fillRect(T[p].left,T[p].top,i.e.sub.width,i.e.sub.height);t.fillStyle=c.onsubBg,t.fillRect(T[a.sub].left,T[a.sub].top,i.e.sub.width,i.e.sub.height),t.font=l.sub,t.textAlign="center",t.textBaseline="middle",t.fillStyle=c.sub;for(var p=0;p<x.length;p++)T[p].left+S>=0&&T[p].left<=o&&t.fillText(x[p],T[p].fontLeft,T[p].fontTop);t.fillStyle=c.onsub,t.fillText(x[a.sub],T[a.sub].fontLeft,T[a.sub].fontTop)}if(s.errorState){var y,k,L,M,m=i.e;M=s.currScore.score,L=s.currScore.scoreTip,k=s.error.coinDemand+e.language.misc.symbol[0],t.fillStyle=c.shadow,t.fillRect(0,0,o,r),y=m.errorShadow,t.roundRect(y.left,y.top,y.width,y.height,y.radius,"fill"),t.fillStyle=e.style.color.normal,y=m.errorBg,t.roundRect(y.left,y.top,y.width,y.height,y.radius,"fill"),t.fillStyle=c.gray,y=m.errorTipBg,t.roundRect(y.left,y.top,y.width,y.height,y.radius,"fill"),t.strokeStyle=e.style.color.reverse,y=m.buttonOut,t.lineWidth=y.lineWidth,t.roundRect(y.left,y.top,y.width,y.height,y.radius,"stroke"),t.fillStyle=e.style.color.reverse,t.textAlign="center",t.textBaseline="middle",t.font=l.button,t.fillText(n.endGame,y.fontLeft,y.fontTop),t.fillStyle=e.style.color.reverse,y=m.buttonGo,t.roundRect(y.left,y.top,y.width,y.height,y.radius,"fill"),t.fillStyle=e.style.color.normal,t.fillText(n.playOn,y.fontLeft,y.fontTop),t.font=l.coin,t.fillText(k,y.fontLeft,y.fontTopB),t.fillStyle=e.style.color.reverse,t.font=l.errotTip,y=m.errorTip,t.fillText(s.error.errorTip,y.left,y.top),t.font=l.errorTitleSub,y=m.errorSubTitle,t.fillText(L,y.left,y.top),t.font=l.errorTitle,y=m.errorTitle,t.fillText(M,y.left,y.top)}},drawSettings:function(){var e,t,o=this,r=o.c2d,i=o.style,a=o.pageData.settings,s=a.TitleList,l=a.e.button.width,n=a.e.button.height,c=a.e.button.fontLeft,u=a.e.button.fontTop,d=a.font,f={};f[3]=s[3]+o.language.misc.symbol[3]+a.soundTitle[o.flags.sound],f[4]=s[4]+o.language.misc.symbol[3]+a.languageTitle[o.flags.language],r.fillStyle=i.color.normal,r.fillRect(0,0,o.dom.width,o.dom.height),r.fillStyle=i.color.reverse,r.font=d.title,r.textAlign="center",r.textBaseline="middle";for(var m=0;m<a.row;m++)r.fillRect(m%2*l,m*n,l,n),e=(m+1)%2+2*m,t=f[e]||s[e],r.fillText(t,(m+1)%2*l+c,m*n+u);r.fillStyle=i.color.normal;for(var m=0;m<a.row;m++)e=m%2+2*m,t=f[e]||s[e],r.fillText(t,m%2*l+c,m*n+u)},drawEnd:function(){var e,t,o,r,i=this,a=i.c2d,s=i.style,l=i.pageData.end,n=l.TitleList,c=l.font,u=i.language[i.flags.language],d=i.b,f=d.run,m=d.mode||"classic";n.coin=i.score.coin+i.language.misc.symbol[0],n.mode=u.modeList[m][0]+u.mode,n.sub=u.modeList[m][1][d.sub],e=f.endColor||"#AAA",n.score=f.currScore.score,n.scoreSub=f.currScore.scoreTip,a.fillStyle=e,a.fillRect(0,0,i.dom.width,i.dom.height),a.fillStyle=s.color.reverse,a.textAlign="center",a.textBaseline="middle",a.font=c.score,t=l.e.score,a.fillText(n.score,t.left,t.top),a.font=c.scoreSub,t=l.e.scoreSub,a.fillText(n.scoreSub,t.left,t.top),a.fillStyle=s.color.normal,a.font=c.title,t=l.e.share,a.fillText(n.share,t.left,t.top),t=l.e.exit,a.fillText(n.exit,t.left,t.top),t=l.e.again,a.fillText(n.again,t.left,t.top),a.font=c.mode,t=l.e.mode,a.fillText(n.mode,t.left,t.top),r=t.top-((l.fontSize.mode+l.fontSize.sub)/2+parseInt(i.dom.height/80)),o=t.left+parseInt(a.measureText(n.mode).width/2),a.font=c.sub,a.textAlign="right",a.fillText(n.sub,o,r),a.textBaseline="top",a.font=c.coin,t=l.e.coin,a.fillText(n.coin,t.left,t.top),a.textAlign="left",a.font=c.gameName,t=l.e.gameName,a.fillText(n.gameName,t.left,t.top),a.font=c.ver,t=l.e.ver,a.fillText(n.ver,t.left,t.top)},main:function(){var e=this,t=function(){"game"==e.page&&e.runGameData(),e.execution(e.page),e.drawInterface(e.page),e.drawTip(),e.animationId=window.requestAnimationFrame(t)};this.animationId=window.requestAnimationFrame(t)}},window.onload=function(){game=new game,game.init()};